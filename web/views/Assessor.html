<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <title>SLT - Assessor Registration</title>
</head>

<style>
  /* ========================= */
  /*       Global Styles       */
  /* ========================= */

  :root{
    --primary-color: #00325c;
    --secondary-color: #00335cb6;
    --third-color: #00335c3b;
    --success-color: #18c427;
    --success-color-hover: #16a125;
    --error-color: #ff4d4f;
    --error-color-hover: #ff1a1a;
    --warning-color: #ffcc00;
    --warning-color-hover: #e6b800;
    --info-color: #1890ff;
    --info-color-hover: #007acc;
    --background-color: #c4c4c4;
    --background-form: #ffffff;
    --text-color-1: #222222;
    --text-color-2: #d3d3d3;

    --font-family: 'Roboto', sans-serif;
    --font-size: 1rem;
    --font-weight: 400;
  }

  /* ========================= */
  /*      General Body         */
  /* ========================= */
  body {
    font-family: var(--font-family);
    font-size: var(--font-size);
    font-weight: var(--font-weight);
    margin: 1rem auto;
    padding: 1rem;
    background: var(--background-color);
    max-width: 75rem;
    max-height: 100vh;
  }

  form {
    background: var(--background-form);
    border-radius: 0.5rem;
    padding: 1rem;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }

  .form-header {
    background-color: var(--primary-color);
    color: var(--text-color-2);
    padding: 1rem;
    text-align: center;
    border-radius: 0.5rem;
  }

  /* ========================= */
  /*      Fieldset Styles      */
  /* ========================= */
  fieldset {
    border: 1px solid var(--third-color);
    border-radius: 0.5rem;
    padding: 1.5rem 1.5rem 1rem 1.5rem;
    margin-bottom: 1.5rem;
    background: #f9f9f9;
  }

  legend {
    font-size: 1.35rem;
    font-weight: 700;
    color: var(--primary-color);
    padding: 0 0.5rem;
    margin-bottom: 0.5rem;
    width: auto;
    letter-spacing: 0.5px;
  }

  /* ========================= */
  /*      Form Layout          */
  /* ========================= */
  .assessor-info,
  .personal-info,
  .contact-info,
  .address-info {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .form-row {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
    flex-wrap: wrap;
  }

  .form-row > div {
    flex: 1;
    min-width: 200px;
  }

  label {
    font-weight: 500;
    margin-bottom: 0.2rem;
    color: var(--primary-color);
  }

  input[type="text"],
  input[type="email"],
  input[type="tel"],
  input[type="date"],
  select {
    padding: 0.5rem 0.75rem;
    border: 1px solid #bfc9d1;
    border-radius: 0.35rem;
    font-size: 1rem;
    background: #fff;
    color: var(--text-color-1);
    transition: border-color 0.2s;
    margin-bottom: 0.5rem;
    width: 100%;
  }

  input[readonly] {
    background: #f1f1f1;
    color: #888;
    cursor: not-allowed;
  }

  input:focus,
  select:focus {
    border-color: var(--primary-color);
    outline: none;
    background: #f0f6fa;
  }

  .required::after {
    content: " *";
    color: var(--error-color);
    font-weight: bold;
  }

  .optional {
    font-style: italic;
    color: #666;
  }

  /* Footer já está estilizado */
  .form-footer {
    background-color: var(--primary-color);
    color: var(--text-color-2);
    padding: 1rem;
    text-align: center;
    border-radius: 0.5rem;
    margin-top: 1rem;
  }

  /* ========================= */
  /*      Button Styles        */
  /* ========================= */
  .button-container {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin: 2rem 0 1rem 0;
    flex-wrap: wrap;
  }

  .form-action-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background-color: var(--primary-color);
    color: #fff;
    border: none;
    border-radius: 0.35rem;
    padding: 0.6rem 1.5rem;
    font-size: 1.08rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s, box-shadow 0.2s;
    box-shadow: 0 2px 8px #00325c1a;
  }

  .form-action-btn:disabled {
    background-color: #bfc9d1;
    color: #eee;
    cursor: not-allowed;
    box-shadow: none;
    opacity: 0.7;
  }

  .form-action-btn:hover:not(:disabled),
  .form-action-btn:focus:not(:disabled) {
    background-color: var(--secondary-color);
    color: #fff;
    outline: none;
  }

  @media (max-width: 767px) {
    .button-container {
      flex-direction: column;
      gap: 0.75rem;
      margin: 1.2rem 0 0.5rem 0;
    }
    .form-action-btn {
      width: 100%;
      justify-content: center;
      font-size: 1rem;
      padding: 0.55rem 1rem;
    }
    .form-row {
      flex-direction: column;
      gap: 0.5rem;
    }
    .form-row > div {
      min-width: unset;
    }
  }

  /* ========================= */
  /*      Responsividade       */
  /* ========================= */

  /* Laptops: 1920x1080 até 1280x720 */
  @media (max-width: 1920px) and (min-width: 1280px) {
    body {
      font-size: 1.1rem;
    }
  }

  /* Tablets: 1279px até 768px */
  @media (max-width: 1279px) and (min-width: 768px) {
    body {
      font-size: 1rem;
      padding: 0 1rem;
    }
  }

  /* Smartphones: até 767px */
  @media (max-width: 767px) {
    body {
      font-size: 0.95rem;
      padding: 0 0.5rem;
    }
  }

  /* ========================= */
  /*  Typography Normalization */
  /* ========================= */
  /* Ensure consistent Roboto rendering across browsers and match Client form */
  body, h1, h2, h3, h4, h5, h6, p, label, input, select, button, textarea {
    font-family: var(--font-family) !important;
    font-weight: var(--font-weight);
    font-synthesis: none; /* avoid faux bold/italic differences */
  }

</style>

<body>
  <form>
    <header>
      <fieldset class="form-header">
        <h1 style="margin: 0;">Silver Linings Therapy And Assessment Services</h1>
        <h2 style="margin: 0.5rem 0;">Assessor Registration Form</h2>
        <p style="margin: 0;">2 Andres St, Niagara on the Lake, Ontario, L0S 1J0</p>
        <p style="margin: 0;"><i class="bi bi-telephone"></i> +1 (416) 937 - 6902 | Fax: +1 (647) 793 - 4140</p>
        <p style="margin: 0;"><i class="bi bi-envelope"></i> silverliningsassociates@gmail.com</p>
      </fieldset>
    </header>

    <!-- Form Information -->
    <fieldset class="assessor-info">
      <legend>Form Information</legend>
      <label for="created-at">Created at:</label>
      <input type="text" id="created-at" name="created-at" readonly>
      
      <div style="background: #e8f4fd; padding: 1rem; border-radius: 0.35rem; border-left: 4px solid var(--info-color); margin-top: 1rem;">
        <p style="margin: 0; color: var(--info-color);"><strong><i class="bi bi-info-circle"></i> Completion & Export Instructions</strong></p>
        <p style="margin: 0.6rem 0 0 0;">This form registers a new <strong>Assessor</strong> and generates two CSV files aligned with the database schema.</p>
        <ul style="margin:0.6rem 0 0 1.1rem; padding:0; font-size:0.92rem; line-height:1.25rem;">
          <li><strong>Required fields</strong>: First Name, Last Name, Email, Phone, Address, City, Province, Postal Code, Country.</li>
          <li><strong>created_at</strong> is generated automatically; <code>id</code> and <code>modified_at</code> are assigned by the backend.</li>
          <li>Clicking "Save Assessor Data" generates: <code>assessor_*.csv</code> and <code>address_assessor_*.csv</li>
          <li>The assessor file columns: firstname, lastname, phone, email, created_at.</li>
          <li>The address file columns: street, city, province, postal_code, created_at (linked later via generated ID).</li>
          <li>Email is normalized to lowercase; names and city are capitalized.</li>
          <li>Phone is formatted if 10 digits (pattern: (XXX) XXX-XXXX).</li>
          <li>Validate the postal code in Canadian format (A1A 1A1).</li>
          <li>Re‑export overwrites existing files (same name). Keep in a dedicated import staging folder.</li>
          <li>Do not edit CSV headers to avoid import failure.</li>
        </ul>
      </div>
    </fieldset>

    <!-- Personal Information -->
    <fieldset class="personal-info">
      <legend>Personal Information</legend>
      
      <div class="form-row">
        <div>
          <label for="first-name" class="required">First Name</label>
          <input type="text" id="first-name" name="first-name" required>
        </div>
        <div>
          <label for="last-name" class="required">Last Name</label>
          <input type="text" id="last-name" name="last-name" required>
        </div>
      </div>
    </fieldset>

    <!-- Contact Information -->
    <fieldset class="contact-info">
      <legend>Contact Information</legend>
      
      <div class="form-row">
        <div>
          <label for="email" class="required">Email Address</label>
          <input type="email" id="email" name="email" required>
        </div>
        <div>
          <label for="phone" class="required">Phone Number</label>
          <input type="tel" id="phone" name="phone" required>
        </div>
      </div>
    </fieldset>

    <!-- Address Information -->
    <fieldset class="address-info">
      <legend>Address Information</legend>
      
      <div class="form-row">
        <div>
          <label for="address" class="required">Street Address</label>
          <input type="text" id="address" name="address" required>
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="city" class="required">City</label>
          <input type="text" id="city" name="city" required>
        </div>
        <div>
          <label for="province" class="required">Province/State</label>
          <select id="province" name="province" required>
            <option value="">Select Province</option>
            <option value="ON">Ontario</option>
            <option value="BC">British Columbia</option>
            <option value="AB">Alberta</option>
            <option value="MB">Manitoba</option>
            <option value="SK">Saskatchewan</option>
            <option value="QC">Quebec</option>
            <option value="NB">New Brunswick</option>
            <option value="NS">Nova Scotia</option>
            <option value="PE">Prince Edward Island</option>
            <option value="NL">Newfoundland and Labrador</option>
            <option value="YT">Yukon</option>
            <option value="NT">Northwest Territories</option>
            <option value="NU">Nunavut</option>
          </select>
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="postal-code" class="required">Postal Code</label>
          <input type="text" id="postal-code" name="postal-code" placeholder="A1A 1A1" required>
        </div>
        <div>
          <label for="country" class="required">Country</label>
          <input type="text" id="country" name="country" value="Canada" required>
        </div>
      </div>

      <div style="background: #fff8e1; padding: 1rem; border-radius: 0.35rem; border-left: 4px solid var(--warning-color); margin-top: 1rem;">
        <p style="margin: 0; color: var(--warning-color);"><strong><i class="bi bi-exclamation-triangle"></i> Note:</strong></p>
        <p style="margin: 0.5rem 0 0 0;">Please ensure all contact information is accurate as it will be used for official communications and case assignments.</p>
      </div>
    </fieldset>

    <!-- Buttons for saving the form -->
    <div class="button-container">
      <button type="button" id="save-btn" class="form-action-btn" disabled>
        <i class="bi bi-download"></i> Save Assessor Data (DB Schema)
      </button>
    </div>

    <footer class="form-footer">
      <div class="footer-contact">
        <p style="margin: 0;">© <span id="copyright-year">2025</span> Silver Linings Therapy And Assessment Services</p>
      </div>
      <div class="footer-info">
        <p style="margin: 0;">All information provided is confidential and will be used for assessor registration purposes only.</p>
      </div>
    </footer>
  </form>

  <script>
    // ========================= 
    //    Assessor Form JavaScript
    // ========================= 

    document.addEventListener('DOMContentLoaded', function() {
      setCreatedAt();
      setupFormSave();
      setupFormValidation();
      setupInputFormatting();
      document.getElementById('copyright-year').textContent = new Date().getFullYear();
    });
    function nowTimestamp(){
      const d=new Date();
      const pad=n=>String(n).padStart(2,'0');
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }
    function setCreatedAt(){
      document.getElementById('created-at').value = nowTimestamp();
    }

    // Setup input formatting for phones, postal codes, etc.
    function setupInputFormatting() {
      // Format postal code
      const postalCodeInput = document.getElementById('postal-code');
      postalCodeInput.addEventListener('input', function() {
        formatPostalCode(this);
      });

      // Format phone number
      const phoneInput = document.getElementById('phone');
      phoneInput.addEventListener('input', function() {
        formatPhoneNumber(this);
      });

      // Capitalize names and city
      const nameInputs = document.querySelectorAll('#first-name, #last-name, #city');
      nameInputs.forEach(input => {
        input.addEventListener('blur', function() {
          capitalizeName(this);
        });
      });

      // Normalize email
      const emailInput = document.getElementById('email');
      emailInput.addEventListener('blur', function() {
        this.value = this.value.toLowerCase().trim();
      });
    }

    // Format postal code (Canadian format: A1A 1A1)
    function formatPostalCode(input) {
      let value = input.value.replace(/\s/g, '').toUpperCase();
      if (value.length === 6) {
        value = value.substring(0, 3) + ' ' + value.substring(3);
      }
      input.value = value;
    }

    // Format phone number (basic formatting)
    function formatPhoneNumber(input) {
      let value = input.value.replace(/\D/g, '');
      if (value.length === 10) {
        value = `(${value.substring(0, 3)}) ${value.substring(3, 6)}-${value.substring(6)}`;
      }
      input.value = value;
    }

    // Capitalize names
    function capitalizeName(input) {
      const words = input.value.toLowerCase().split(' ');
      const capitalizedWords = words.map(word => 
        word.charAt(0).toUpperCase() + word.slice(1)
      );
      input.value = capitalizedWords.join(' ');
    }

    // Setup form validation and button state management
    function setupFormValidation() {
      const saveBtn = document.getElementById('save-btn');
      
      // Initially disable the save button
      saveBtn.disabled = true;
      
      // Get all required inputs
      const requiredInputs = document.querySelectorAll('input[required], select[required]');
      
      requiredInputs.forEach(input => {
        input.addEventListener('input', function() { updateSaveButtonState(); });
        input.addEventListener('change', function() { updateSaveButtonState(); });
      });
      
      // Initial check
      updateSaveButtonState();
    }

    // Update save button state based on form completion
    function updateSaveButtonState() {
      const saveBtn = document.getElementById('save-btn');
      
      // Check if all required fields are filled
  const requiredInputs = document.querySelectorAll('input[required], select[required]');
      let allRequiredFilled = true;
      
      requiredInputs.forEach(input => {
        if (!input.value.trim()) {
          allRequiredFilled = false;
        }
      });
      
      // Additional email validation
      const emailInput = document.getElementById('email');
      const emailValid = emailInput.value && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value);
      
      // Enable/disable save button
      saveBtn.disabled = !(allRequiredFilled && emailValid);
    }

    // Setup form save functionality
    function setupFormSave() {
      const saveBtn = document.getElementById('save-btn');
      
      saveBtn.addEventListener('click', function() {
        if (validateForm()) {
          saveFormData();
        } else {
          alert('Please fill in all required fields correctly before saving.');
        }
      });
    }

    // Validate form
    function validateForm() {
      const requiredInputs = document.querySelectorAll('input[required], select[required]');
      let allValid = true;
      
      requiredInputs.forEach(input => {
        if (!input.value.trim()) {
          allValid = false;
        }
      });
      
      // Validate email format
      const emailInput = document.getElementById('email');
      const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value);
      if (!emailValid) {
        alert('Please enter a valid email address.');
        return false;
      }
      
      // Validate postal code format (basic Canadian postal code check)
      const postalCode = document.getElementById('postal-code').value;
      const postalCodeValid = /^[A-Za-z]\d[A-Za-z] \d[A-Za-z]\d$/.test(postalCode);
      if (!postalCodeValid && postalCode.length > 0) {
        alert('Please enter a valid Canadian postal code (e.g., A1A 1A1).');
        return false;
      }
      
      return allValid;
    }

    // Save form data: generate two CSV files (assessor table + address table)
    function saveFormData() {
  const { assessorRecord, addressRecord } = collectFormData();
  const assessorCSV = generateAssessorCSV(assessorRecord);
  const addressCSV = generateAddressCSV(addressRecord);
  downloadCSV(assessorCSV, `assessor_${assessorRecord.firstname}_${assessorRecord.lastname}.csv`);
  downloadCSV(addressCSV, `address_assessor_${assessorRecord.firstname}_${assessorRecord.lastname}.csv`);
    }

    // Collect all form data
    function collectFormData() {
      const ts = document.getElementById('created-at').value.trim();
      const assessorRecord = {
        firstname: document.getElementById('first-name').value.trim(),
        lastname: document.getElementById('last-name').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        email: document.getElementById('email').value.trim().toLowerCase(),
        created_at: ts
      };
      const addressRecord = {
        user_key: '', // will be resolver on DB insert (FK to generated assessor id)
        street: document.getElementById('address').value.trim(),
        city: document.getElementById('city').value.trim(),
        province: document.getElementById('province').value.trim(),
        postal_code: document.getElementById('postal-code').value.trim().toUpperCase(),
        created_at: ts
      };
      return { assessorRecord, addressRecord };
    }

    // Generate CSV content
    function generateAssessorCSV(r){
      const headers=['firstname','lastname','phone','email','created_at'];
      const values=[r.firstname,r.lastname,r.phone,r.email,r.created_at];
      return headers.join(',')+'\n'+values.map(csvEscape).join(',');
    }
    function generateAddressCSV(r){
      const headers=['street','city','province','postal_code','created_at'];
      const values=[r.street,r.city,r.province,r.postal_code,r.created_at];
      return headers.join(',')+'\n'+values.map(csvEscape).join(',');
    }
    function csvEscape(v){ if(v==null) return ''; const s=String(v); return /[",\n]/.test(s)? '"'+s.replace(/"/g,'""')+'"':s; }

    // Download CSV file
    function downloadCSV(csvContent, filename) {
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      
      if (link.download !== undefined) {
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', filename);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        alert(`Assessor data saved as ${filename}`);
      } else {
        alert('File download not supported in this browser.');
      }
    }

    // Update copyright year
    document.getElementById('copyright-year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
