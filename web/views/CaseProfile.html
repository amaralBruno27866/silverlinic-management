<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <title>SLT - Case Profile Information</title>
</head>

<style>
  /* ========================= */
  /*       Global Styles       */
  /* ========================= */

  :root{
    --primary-color: #00325c;
    --secondary-color: #00335cb6;
    --third-color: #00335c3b;
    --success-color: #18c427;
    --success-color-hover: #16a125;
    --error-color: #ff4d4f;
    --error-color-hover: #ff1a1a;
    --warning-color: #ffcc00;
    --warning-color-hover: #e6b800;
    --info-color: #1890ff;
    --info-color-hover: #007acc;
    --background-color: #c4c4c4;
    --background-form: #ffffff;
    --text-color-1: #222222;
    --text-color-2: #d3d3d3;

    --font-family: 'Roboto', sans-serif;
    --font-size: 1rem;
    --font-weight: 400;
  }

  /* ========================= */
  /*      General Body         */
  /* ========================= */
  body {
    font-family: var(--font-family);
    font-size: var(--font-size);
    font-weight: var(--font-weight);
    margin: 1rem auto;
    padding: 1rem;
    background: var(--background-color);
    max-width: 75rem;
    max-height: 100vh;
  }

  form {
    background: var(--background-form);
    border-radius: 0.5rem;
    padding: 1rem;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }

  .form-header {
    background-color: var(--primary-color);
    color: var(--text-color-2);
    padding: 1rem;
    text-align: center;
    border-radius: 0.5rem;
  }

  /* ========================= */
  /*      Fieldset Styles      */
  /* ========================= */
  fieldset {
    border: 1px solid var(--third-color);
    border-radius: 0.5rem;
    padding: 1.5rem 1.5rem 1rem 1.5rem;
    margin-bottom: 1.5rem;
    background: #f9f9f9;
  }

  legend {
    font-size: 1.35rem;
    font-weight: 700;
    color: var(--primary-color);
    padding: 0 0.5rem;
    margin-bottom: 0.5rem;
    width: auto;
    letter-spacing: 0.5px;
  }

  /* ========================= */
  /*      Form Layout          */
  /* ========================= */
  .case-info,
  .family-physician-info,
  .emergency-contact-info,
  .legal-representative-info,
  .insurance-company-info,
  .case-notes-info {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .form-row {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
    flex-wrap: wrap;
  }

  .form-row > div {
    flex: 1;
    min-width: 200px;
  }

  label {
    font-weight: 500;
    margin-bottom: 0.2rem;
    color: var(--primary-color);
  }

  input[type="text"],
  input[type="email"],
  input[type="tel"],
  input[type="date"],
  select,
  textarea {
    padding: 0.5rem 0.75rem;
    border: 1px solid #bfc9d1;
    border-radius: 0.35rem;
    font-size: 1rem;
    background: #fff;
    color: var(--text-color-1);
    transition: border-color 0.2s;
    margin-bottom: 0.5rem;
    width: 100%;
  }

  input[readonly] {
    background: #f1f1f1;
    color: #888;
    cursor: not-allowed;
  }

  input:focus,
  select:focus,
  textarea:focus {
    border-color: var(--primary-color);
    outline: none;
    background: #f0f6fa;
  }

  textarea {
    min-height: 4rem;
    resize: vertical;
  }

  .required::after {
    content: " *";
    color: var(--error-color);
    font-weight: bold;
  }

  .optional {
    font-style: italic;
    color: #666;
  }

  /* Footer já está estilizado */
  .form-footer {
    background-color: var(--primary-color);
    color: var(--text-color-2);
    padding: 1rem;
    text-align: center;
    border-radius: 0.5rem;
    margin-top: 1rem;
  }

  /* ========================= */
  /*      Button Styles        */
  /* ========================= */
  .button-container {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin: 2rem 0 1rem 0;
    flex-wrap: wrap;
  }

  .form-action-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background-color: var(--primary-color);
    color: #fff;
    border: none;
    border-radius: 0.35rem;
    padding: 0.6rem 1.5rem;
    font-size: 1.08rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s, box-shadow 0.2s;
    box-shadow: 0 2px 8px #00325c1a;
  }

  .form-action-btn:disabled {
    background-color: #bfc9d1;
    color: #eee;
    cursor: not-allowed;
    box-shadow: none;
    opacity: 0.7;
  }

  .form-action-btn:hover:not(:disabled),
  .form-action-btn:focus:not(:disabled) {
    background-color: var(--secondary-color);
    color: #fff;
    outline: none;
  }

  @media (max-width: 767px) {
    .button-container {
      flex-direction: column;
      gap: 0.75rem;
      margin: 1.2rem 0 0.5rem 0;
    }
    .form-action-btn {
      width: 100%;
      justify-content: center;
      font-size: 1rem;
      padding: 0.55rem 1rem;
    }
    .form-row {
      flex-direction: column;
      gap: 0.5rem;
    }
    .form-row > div {
      min-width: unset;
    }
  }

  /* ========================= */
  /*      Responsividade       */
  /* ========================= */

  /* Laptops: 1920x1080 até 1280x720 */
  @media (max-width: 1920px) and (min-width: 1280px) {
    body {
      font-size: 1.1rem;
    }
  }

  /* Tablets: 1279px até 768px */
  @media (max-width: 1279px) and (min-width: 768px) {
    body {
      font-size: 1rem;
      padding: 0 1rem;
    }
  }

  /* Smartphones: até 767px */
  @media (max-width: 767px) {
    body {
      font-size: 0.95rem;
      padding: 0 0.5rem;
    }
  }

</style>

<body>
  <form>
    <header>
      <fieldset class="form-header">
        <h1 style="margin: 0;">Silver Linings Therapy And Assessment Services</h1>
        <h2 style="margin: 0.5rem 0;">Case Profile Information Form</h2>
        <p style="margin: 0;">2 Andres St, Niagara on the Lake, Ontario, L0S 1J0</p>
        <p style="margin: 0;"><i class="bi bi-telephone"></i> +1 (416) 937 - 6902 | Fax: +1 (647) 793 - 4140</p>
        <p style="margin: 0;"><i class="bi bi-envelope"></i> silverliningsassociates@gmail.com</p>
      </fieldset>
    </header>

    <!-- Form Information -->
    <fieldset class="case-info">
      <legend>Form Information</legend>
      <div class="form-row">
        <div>
          <label for="client-id" class="required">Client ID</label>
          <input type="text" id="client-id" name="client-id" pattern="^\\d*$" placeholder="Numbers only" required>
        </div>
        <div>
          <label for="assessor-id" class="required">Assessor ID</label>
          <input type="text" id="assessor-id" name="assessor-id" pattern="^\\d*$" placeholder="Numbers only" required>
        </div>
        <div>
          <label for="form-created-at">Created at:</label>
          <input type="text" id="form-created-at" name="form-created-at" readonly>
        </div>
      </div>
      <div class="form-row">
        <div>
          <label for="client-first-name" class="optional">Client First Name</label>
          <input type="text" id="client-first-name" maxlength="60">
        </div>
        <div>
          <label for="assessor-first-name" class="optional">Assessor First Name</label>
          <input type="text" id="assessor-first-name" maxlength="60">
        </div>
      </div>
      <div style="background: #e8f4fd; padding: 1rem; border-radius: 0.35rem; border-left: 4px solid var(--info-color); margin-top: 1rem;">
        <p style="margin: 0; color: var(--info-color);"><strong><i class="bi bi-info-circle"></i> Completion & Export Instructions</strong></p>
        <p style="margin: 0.5rem 0 0 0;">
          This form gathers data to create a <strong>Case Profile</strong> and its associated contacts (Family Physician, Emergency Contact, Legal Representative, and Insurance Company).
        </p>
        <ul style="margin:0.6rem 0 0 1.1rem; padding:0; font-size:0.92rem; line-height:1.25rem;">
          <li><strong>Client ID</strong> and <strong>Assessor ID</strong> are required and must already exist (digits only).</li>
          <li>The first names displayed (Client / Assessor First Name) are for visual reference only and <strong>are not exported</strong>.</li>
          <li>Use the buttons (CASE, FPH, ECT, LRT, ICO) to generate separate CSVs for each database table.</li>
          <li><strong>Export All CSVs</strong> attempts to generate every file (only those with valid data are created).</li>
          <li>The file <code>case_profile.csv</code> includes: client_id, assessor_id, status, notes, created_at, closed_at (no id / modified_at).</li>
          <li>Columns <code>id</code>, <code>modified_at</code> and extra foreign keys are assigned by the backend after import.</li>
          <li><strong>Status</strong>: keep "Pending" until the case is actually opened. If you set "Closed", provide a Closed At date.</li>
          <li><strong>Notes</strong> (optional) max 1500 characters — review before exporting.</li>
          <li>Re‑exporting overwrites the previous file (same name). Organize downloads in a dedicated folder.</li>
          <li>Validate phone numbers / emails before exporting; basic formatting adjustments are applied automatically.</li>
        </ul>
      </div>
    </fieldset>

    <!-- Case Profile Meta (status & notes) -->
    <fieldset class="case-profile-meta">
      <legend>Case Profile Meta</legend>
      <div class="form-row">
        <div>
          <label for="cp-status" class="required">Status</label>
          <select id="cp-status" required>
            <option value="Pending" selected>Pending</option>
            <option value="Open">Open</option>
            <option value="Closed">Closed</option>
            <option value="On Hold">On Hold</option>
          </select>
        </div>
        <div>
          <label for="cp-closed-at" class="optional">Closed At (if applicable)</label>
          <input type="date" id="cp-closed-at">
        </div>
      </div>
      <div class="form-row">
        <div style="flex:1;">
          <label for="cp-notes" class="optional">Notes (max 1500 chars)</label>
          <textarea id="cp-notes" maxlength="1500" placeholder="Internal case notes (stored in case_profile.notes)"></textarea>
        </div>
      </div>
    </fieldset>

    <!-- Family Physician Information -->
    <fieldset class="family-physician-info">
      <legend>Family Physician Information</legend>
      
      <div class="form-row">
        <div>
          <label for="fp-full-name" class="required">Physician Name</label>
          <input type="text" id="fp-full-name" name="fp-full-name" required>
        </div>
        <div>
          <label for="fp-phone" class="optional">Phone</label>
          <input type="tel" id="fp-phone" name="fp-phone">
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="fp-email" class="optional">Email</label>
          <input type="email" id="fp-email" name="fp-email">
        </div>
      </div>

      <!-- Address Section -->
      <div style="background: #f5f7fa; padding: 1rem; border-radius: 0.35rem; margin-top: 1rem;">
        <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Address</h4>
        
        <div class="form-row">
          <div>
            <label for="fp-address" class="optional">Street Address</label>
            <input type="text" id="fp-address" name="fp-address">
          </div>
        </div>
        
        <div class="form-row">
          <div>
            <label for="fp-city" class="optional">City</label>
            <input type="text" id="fp-city" name="fp-city">
          </div>
          <div>
            <label for="fp-province" class="optional">Province/State</label>
            <select id="fp-province" name="fp-province">
              <option value="">Select Province</option>
              <option value="ON">Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="AB">Alberta</option>
              <option value="MB">Manitoba</option>
              <option value="SK">Saskatchewan</option>
              <option value="QC">Quebec</option>
              <option value="NB">New Brunswick</option>
              <option value="NS">Nova Scotia</option>
              <option value="PE">Prince Edward Island</option>
              <option value="NL">Newfoundland and Labrador</option>
              <option value="YT">Yukon</option>
              <option value="NT">Northwest Territories</option>
              <option value="NU">Nunavut</option>
            </select>
          </div>
        </div>
        
        <div class="form-row">
          <div>
            <label for="fp-postal-code" class="optional">Postal Code</label>
            <input type="text" id="fp-postal-code" name="fp-postal-code" placeholder="A1A 1A1">
          </div>
          <div>
            <label for="fp-country" class="optional">Country</label>
            <input type="text" id="fp-country" name="fp-country" value="Canada">
          </div>
        </div>
      </div>
    </fieldset>

    <!-- Emergency Contact Information -->
    <fieldset class="emergency-contact-info">
      <legend>Emergency Contact Information</legend>
      
      <div class="form-row">
        <div>
          <label for="ec-full-name" class="required">Full Name</label>
          <input type="text" id="ec-full-name" name="ec-full-name" required>
        </div>
        <div>
          <label for="ec-relationship" class="required">Relationship</label>
          <select id="ec-relationship" name="ec-relationship" required>
            <option value="">Select Relationship</option>
            <option value="Spouse">Spouse</option>
            <option value="Parent">Parent</option>
            <option value="Child">Child</option>
            <option value="Sibling">Sibling</option>
            <option value="Friend">Friend</option>
            <option value="Partner">Partner</option>
            <option value="Guardian">Legal Guardian</option>
            <option value="Other">Other</option>
          </select>
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="ec-phone" class="required">Primary Phone</label>
          <input type="tel" id="ec-phone" name="ec-phone" required>
        </div>
        <div>
          <label for="ec-alt-phone" class="optional">Alternative Phone</label>
          <input type="tel" id="ec-alt-phone" name="ec-alt-phone">
        </div>
      </div>
    </fieldset>

    <!-- Legal Representative Information -->
    <fieldset class="legal-representative-info">
      <legend>Legal Representative Information <span class="optional">(Optional)</span></legend>
      
      <div class="form-row">
        <div>
          <label for="lr-company-name" class="optional">Law Firm / Company Name</label>
          <input type="text" id="lr-company-name" name="lr-company-name">
        </div>
        <div>
          <label for="lr-full-name" class="optional">Representative Name</label>
          <input type="text" id="lr-full-name" name="lr-full-name">
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="lr-phone" class="optional">Phone</label>
          <input type="tel" id="lr-phone" name="lr-phone">
        </div>
        <div>
          <label for="lr-email" class="optional">Email</label>
          <input type="email" id="lr-email" name="lr-email">
        </div>
      </div>
    </fieldset>

    <!-- Insurance Company Information -->
    <fieldset class="insurance-company-info">
      <legend>Insurance Company Information <span class="optional">(Optional)</span></legend>
      
      <div class="form-row">
        <div>
          <label for="ic-company-name" class="optional">Insurance Company Name</label>
          <input type="text" id="ic-company-name" name="ic-company-name">
        </div>
        <div>
          <label for="ic-adjuster-name" class="optional">Adjuster Name</label>
          <input type="text" id="ic-adjuster-name" name="ic-adjuster-name">
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="ic-phone" class="optional">Phone</label>
          <input type="tel" id="ic-phone" name="ic-phone">
        </div>
        <div>
          <label for="ic-email" class="optional">Email</label>
          <input type="email" id="ic-email" name="ic-email">
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="ic-claim-number" class="optional">Claim Number</label>
          <input type="text" id="ic-claim-number" name="ic-claim-number">
        </div>
        <div>
          <label for="ic-policy-number" class="optional">Policy Number</label>
          <input type="text" id="ic-policy-number" name="ic-policy-number">
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="ic-date-accident" class="optional">Date of Accident</label>
          <input type="date" id="ic-date-accident" name="ic-date-accident">
        </div>
        <div></div> <!-- Empty div for spacing -->
      </div>
    </fieldset>

    <!-- Buttons for exporting CSVs -->
    <div class="button-container">
  <button type="button" id="export-all-btn" class="form-action-btn"><i class="bi bi-download"></i> Export All CSVs</button>
      <button type="button" id="export-cp-btn" class="form-action-btn" style="background:#0aa"><i class="bi bi-clipboard-data"></i> CASE</button>
      <button type="button" id="export-fp-btn" class="form-action-btn" style="background:#0d6efd"><i class="bi bi-file-earmark-medical"></i> FPH</button>
      <button type="button" id="export-ec-btn" class="form-action-btn" style="background:#198754"><i class="bi bi-telephone"></i> ECT</button>
      <button type="button" id="export-lr-btn" class="form-action-btn" style="background:#6f42c1"><i class="bi bi-bank"></i> LRT</button>
      <button type="button" id="export-ic-btn" class="form-action-btn" style="background:#fd7e14"><i class="bi bi-shield-check"></i> ICO</button>
      <button type="reset" id="reset-btn" class="form-action-btn" style="background:#6c757d"><i class="bi bi-arrow-counterclockwise"></i> Reset</button>
    </div>

    <footer class="form-footer">
      <div class="footer-contact">
        <p style="margin: 0;">© <span id="copyright-year">2025</span> Silver Linings Therapy And Assessment Services</p>
      </div>
      <div class="footer-info">
        <p style="margin: 0;">All information provided is confidential and will be used to create a complete case profile.</p>
      </div>
    </footer>
  </form>

  <script>
    // ========================= NEW MULTI-CSV EXPORT LOGIC =========================
    (function(){
      const createdAtInput = document.getElementById('form-created-at');
      function setCreatedAt(){
        const now = new Date().toISOString();
        createdAtInput.value = now;
      }
      setCreatedAt();
      document.getElementById('reset-btn').addEventListener('click', ()=> setTimeout(setCreatedAt,50));

      // Formatting helpers reused
      function normalize(str){ return (str||'').trim().replace(/\s+/g,' '); }
      function onlyDigits(str){ return (str||'').replace(/\D/g,''); }
      function formatPhone(val){
        const d = onlyDigits(val);
        if(d.length===10) return `(${d.substring(0,3)}) ${d.substring(3,6)}-${d.substring(6)}`;
        return val.trim();
      }
      document.querySelectorAll('input[type="tel"]').forEach(inp=>{
        inp.addEventListener('blur',()=>{ inp.value = formatPhone(inp.value); });
      });
      document.getElementById('fp-postal-code').addEventListener('blur', e=>{
        let v = e.target.value.replace(/\s/g,'').toUpperCase();
        if(v.length===6) v = v.substring(0,3)+' '+v.substring(3);
        e.target.value = v;
      });

      function downloadCSV(filename, headers, row){
        const line = row.map(v=>{
          if(v===undefined||v===null) return '';
            const s = String(v).replace(/"/g,'""');
            return /[",\n]/.test(s)?`"${s}`+`"`:s;
        }).join(',');
        const csv = headers.join(',')+'\n'+line+'\n';
        const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
      }

      function getShared(){
        const clientIdRaw = normalize(document.getElementById('client-id').value);
        const assessorIdRaw = normalize(document.getElementById('assessor-id').value);
  if(!clientIdRaw || !assessorIdRaw){ alert('Client ID and Assessor ID are required.'); return null; }
  if(!/^\d+$/.test(clientIdRaw)){ alert('Client ID must contain digits only.'); return null; }
  if(!/^\d+$/.test(assessorIdRaw)){ alert('Assessor ID must contain digits only.'); return null; }
        return { client_id: clientIdRaw, assessor_id: assessorIdRaw, created_at: createdAtInput.value };
      }

      // Case Profile export (case_profile table)
      function exportCaseProfile(){
        const shared = getShared(); if(!shared) return false;
        const status = document.getElementById('cp-status').value || 'Pending';
        const notes = normalize(document.getElementById('cp-notes').value);
        const closedAt = document.getElementById('cp-closed-at').value; // optional
  if(notes.length > 1500){ alert('Notes exceed 1500 characters (limit 1500).'); return false; }
        // DB columns (excluding id, modified_at): client_id, assessor_id, status, notes, created_at, closed_at
        const headers = ['client_id','assessor_id','status','notes','created_at','closed_at'];
        const row = [shared.client_id, shared.assessor_id, status, notes, shared.created_at, closedAt];
        downloadCSV('case_profile.csv', headers, row);
        return true;
      }

      // Family Physician
      function exportFP(){
        const fullName = normalize(document.getElementById('fp-full-name').value);
  if(!fullName) { alert('Family Physician Name is required to export FPH.'); return false; }
        const phone = normalize(document.getElementById('fp-phone').value);
        const email = normalize(document.getElementById('fp-email').value);
        const shared = getShared(); if(!shared) return false;
        const headers = ['type','client_id','full_name','phone','email','created_at'];
        const row = ['FPH', shared.client_id, fullName, phone, email, shared.created_at];
        downloadCSV('family_physician.csv', headers, row);
        // Export address separately if any field present (aligns with address table to be linked later by backend)
        const street = normalize(document.getElementById('fp-address').value);
        const city = normalize(document.getElementById('fp-city').value);
        const province = normalize(document.getElementById('fp-province').value);
        const postal = normalize(document.getElementById('fp-postal-code').value);
        if(street || city || province || postal){
          const addrHeaders = ['street','city','province','postal_code','created_at'];
          const addrRow = [street, city, province, postal, shared.created_at];
          downloadCSV('family_physician_address.csv', addrHeaders, addrRow);
        }
        return true;
      }

      // Emergency Contact
      function exportEC(){
        const full = normalize(document.getElementById('ec-full-name').value);
        const rel = normalize(document.getElementById('ec-relationship').value);
        const phone = normalize(document.getElementById('ec-phone').value);
  if(!full && !rel && !phone) { alert('Enter at least Name, Relationship and Phone to export ECT.'); return false; }
  if(!(full && rel && phone)) { alert('Required ECT fields are missing.'); return false; }
        const alt = normalize(document.getElementById('ec-alt-phone').value);
        const shared = getShared(); if(!shared) return false;
        const headers = ['type','client_id','full_name','relationship','phone','alt_phone','created_at'];
        const row = ['ECT', shared.client_id, full, rel, phone, alt, shared.created_at];
        downloadCSV('emergency_contact.csv', headers, row);
        return true;
      }

      // Legal Representative
      function exportLR(){
        const company = normalize(document.getElementById('lr-company-name').value);
        const full = normalize(document.getElementById('lr-full-name').value);
        const phone = normalize(document.getElementById('lr-phone').value);
        const email = normalize(document.getElementById('lr-email').value);
  if(!company && !full && !phone && !email){ alert('Enter data to export LRT.'); return false; }
  if(!(company && full && phone && email)){ alert('LRT requires Company, Full Name, Phone and Email.'); return false; }
        const shared = getShared(); if(!shared) return false;
        const headers = ['type','client_id','company_name','full_name','phone','email','created_at'];
        const row = ['LRT', shared.client_id, company, full, phone, email, shared.created_at];
        downloadCSV('legal_representative.csv', headers, row);
        return true;
      }

      // Insurance Company
      function exportIC(){
        const company = normalize(document.getElementById('ic-company-name').value);
        const adjuster = normalize(document.getElementById('ic-adjuster-name').value);
  if(!company && !adjuster && !document.getElementById('ic-claim-number').value){ alert('Enter data to export ICO.'); return false; }
  if(!(company && adjuster)){ alert('ICO requires Company Name and Adjuster Name.'); return false; }
        const phone = normalize(document.getElementById('ic-phone').value);
        const email = normalize(document.getElementById('ic-email').value);
        const claim = normalize(document.getElementById('ic-claim-number').value);
        const policy = normalize(document.getElementById('ic-policy-number').value);
        const dateAcc = normalize(document.getElementById('ic-date-accident').value);
        const shared = getShared(); if(!shared) return false;
        const headers = ['type','client_id','company_name','adjuster_name','phone','email','claim_number','policy_number','date_accident','created_at'];
        const row = ['ICO', shared.client_id, company, adjuster, phone, email, claim, policy, dateAcc, shared.created_at];
        downloadCSV('insurance_company.csv', headers, row);
        return true;
      }

      // Button bindings
  document.getElementById('export-cp-btn').addEventListener('click', exportCaseProfile);
  document.getElementById('export-fp-btn').addEventListener('click', exportFP);
      document.getElementById('export-ec-btn').addEventListener('click', exportEC);
      document.getElementById('export-lr-btn').addEventListener('click', exportLR);
      document.getElementById('export-ic-btn').addEventListener('click', exportIC);
      document.getElementById('export-all-btn').addEventListener('click', ()=>{
        const results = [exportCaseProfile(), exportFP(), exportEC(), exportLR(), exportIC()];
  if(!results.some(r=>r)) alert('No CSV exported – fill at least one section.');
      });

      // Footer year
      document.getElementById('copyright-year').textContent = new Date().getFullYear();
    })();
  </script>
</body>
</html>
