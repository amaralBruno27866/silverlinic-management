<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <title>SLT - Case Profile Information</title>
</head>

<style>
  /* ========================= */
  /*       Global Styles       */
  /* ========================= */

  :root{
    --primary-color: #00325c;
    --secondary-color: #00335cb6;
    --third-color: #00335c3b;
    --success-color: #18c427;
    --success-color-hover: #16a125;
    --error-color: #ff4d4f;
    --error-color-hover: #ff1a1a;
    --warning-color: #ffcc00;
    --warning-color-hover: #e6b800;
    --info-color: #1890ff;
    --info-color-hover: #007acc;
    --background-color: #c4c4c4;
    --background-form: #ffffff;
    --text-color-1: #222222;
    --text-color-2: #d3d3d3;

    --font-family: 'Roboto', sans-serif;
    --font-size: 1rem;
    --font-weight: 400;
  }

  /* ========================= */
  /*      General Body         */
  /* ========================= */
  body {
    font-family: var(--font-family);
    font-size: var(--font-size);
    font-weight: var(--font-weight);
    margin: 1rem auto;
    padding: 1rem;
    background: var(--background-color);
    max-width: 75rem;
    max-height: 100vh;
  }

  form {
    background: var(--background-form);
    border-radius: 0.5rem;
    padding: 1rem;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }

  .form-header {
    background-color: var(--primary-color);
    color: var(--text-color-2);
    padding: 1rem;
    text-align: center;
    border-radius: 0.5rem;
  }

  /* ========================= */
  /*      Fieldset Styles      */
  /* ========================= */
  fieldset {
    border: 1px solid var(--third-color);
    border-radius: 0.5rem;
    padding: 1.5rem 1.5rem 1rem 1.5rem;
    margin-bottom: 1.5rem;
    background: #f9f9f9;
  }

  legend {
    font-size: 1.35rem;
    font-weight: 700;
    color: var(--primary-color);
    padding: 0 0.5rem;
    margin-bottom: 0.5rem;
    width: auto;
    letter-spacing: 0.5px;
  }

  /* ========================= */
  /*      Form Layout          */
  /* ========================= */
  .case-info,
  .family-physician-info,
  .emergency-contact-info,
  .legal-representative-info,
  .insurance-company-info,
  .case-notes-info {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .form-row {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
    flex-wrap: wrap;
  }

  .form-row > div {
    flex: 1;
    min-width: 200px;
  }

  label {
    font-weight: 500;
    margin-bottom: 0.2rem;
    color: var(--primary-color);
  }

  input[type="text"],
  input[type="email"],
  input[type="tel"],
  input[type="date"],
  select,
  textarea {
    padding: 0.5rem 0.75rem;
    border: 1px solid #bfc9d1;
    border-radius: 0.35rem;
    font-size: 1rem;
    background: #fff;
    color: var(--text-color-1);
    transition: border-color 0.2s;
    margin-bottom: 0.5rem;
    width: 100%;
  }

  input[readonly] {
    background: #f1f1f1;
    color: #888;
    cursor: not-allowed;
  }

  input:focus,
  select:focus,
  textarea:focus {
    border-color: var(--primary-color);
    outline: none;
    background: #f0f6fa;
  }

  textarea {
    min-height: 4rem;
    resize: vertical;
  }

  .required::after {
    content: " *";
    color: var(--error-color);
    font-weight: bold;
  }

  .optional {
    font-style: italic;
    color: #666;
  }

  /* Footer já está estilizado */
  .form-footer {
    background-color: var(--primary-color);
    color: var(--text-color-2);
    padding: 1rem;
    text-align: center;
    border-radius: 0.5rem;
    margin-top: 1rem;
  }

  /* ========================= */
  /*      Button Styles        */
  /* ========================= */
  .button-container {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin: 2rem 0 1rem 0;
    flex-wrap: wrap;
  }

  .form-action-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background-color: var(--primary-color);
    color: #fff;
    border: none;
    border-radius: 0.35rem;
    padding: 0.6rem 1.5rem;
    font-size: 1.08rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s, box-shadow 0.2s;
    box-shadow: 0 2px 8px #00325c1a;
  }

  .form-action-btn:disabled {
    background-color: #bfc9d1;
    color: #eee;
    cursor: not-allowed;
    box-shadow: none;
    opacity: 0.7;
  }

  .form-action-btn:hover:not(:disabled),
  .form-action-btn:focus:not(:disabled) {
    background-color: var(--secondary-color);
    color: #fff;
    outline: none;
  }

  @media (max-width: 767px) {
    .button-container {
      flex-direction: column;
      gap: 0.75rem;
      margin: 1.2rem 0 0.5rem 0;
    }
    .form-action-btn {
      width: 100%;
      justify-content: center;
      font-size: 1rem;
      padding: 0.55rem 1rem;
    }
    .form-row {
      flex-direction: column;
      gap: 0.5rem;
    }
    .form-row > div {
      min-width: unset;
    }
  }

  /* ========================= */
  /*      Responsividade       */
  /* ========================= */

  /* Laptops: 1920x1080 até 1280x720 */
  @media (max-width: 1920px) and (min-width: 1280px) {
    body {
      font-size: 1.1rem;
    }
  }

  /* Tablets: 1279px até 768px */
  @media (max-width: 1279px) and (min-width: 768px) {
    body {
      font-size: 1rem;
      padding: 0 1rem;
    }
  }

  /* Smartphones: até 767px */
  @media (max-width: 767px) {
    body {
      font-size: 0.95rem;
      padding: 0 0.5rem;
    }
  }

</style>

<body>
  <form>
    <header>
      <fieldset class="form-header">
        <h1 style="margin: 0;">Silver Linings Therapy And Assessment Services</h1>
        <h2 style="margin: 0.5rem 0;">Case Profile Information Form</h2>
        <p style="margin: 0;">2 Andres St, Niagara on the Lake, Ontario, L0S 1J0</p>
        <p style="margin: 0;"><i class="bi bi-telephone"></i> +1 (416) 937 - 6902 | Fax: +1 (647) 793 - 4140</p>
        <p style="margin: 0;"><i class="bi bi-envelope"></i> silverliningsassociates@gmail.com</p>
      </fieldset>
    </header>

    <!-- Form Information -->
    <fieldset class="case-info">
      <legend>Form Information</legend>
      
      <label for="form-created-at">Created at:</label>
      <input type="text" id="form-created-at" name="form-created-at" readonly>
      
      <div style="background: #e8f4fd; padding: 1rem; border-radius: 0.35rem; border-left: 4px solid var(--info-color); margin-top: 1rem;">
        <p style="margin: 0; color: var(--info-color);"><strong><i class="bi bi-info-circle"></i> Important:</strong></p>
        <p style="margin: 0.5rem 0 0 0;">This form collects information needed to create a complete Case Profile. The Client and Assessor will be assigned later during the case creation process.</p>
      </div>
    </fieldset>

    <!-- Family Physician Information -->
    <fieldset class="family-physician-info">
      <legend>Family Physician Information</legend>
      
      <div class="form-row">
        <div>
          <label for="fp-full-name" class="required">Physician Name</label>
          <input type="text" id="fp-full-name" name="fp-full-name" required>
        </div>
        <div>
          <label for="fp-phone" class="optional">Phone</label>
          <input type="tel" id="fp-phone" name="fp-phone">
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="fp-email" class="optional">Email</label>
          <input type="email" id="fp-email" name="fp-email">
        </div>
      </div>

      <!-- Address Section -->
      <div style="background: #f5f7fa; padding: 1rem; border-radius: 0.35rem; margin-top: 1rem;">
        <h4 style="margin: 0 0 1rem 0; color: var(--primary-color);">Address</h4>
        
        <div class="form-row">
          <div>
            <label for="fp-address" class="optional">Street Address</label>
            <input type="text" id="fp-address" name="fp-address">
          </div>
        </div>
        
        <div class="form-row">
          <div>
            <label for="fp-city" class="optional">City</label>
            <input type="text" id="fp-city" name="fp-city">
          </div>
          <div>
            <label for="fp-province" class="optional">Province/State</label>
            <select id="fp-province" name="fp-province">
              <option value="">Select Province</option>
              <option value="ON">Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="AB">Alberta</option>
              <option value="MB">Manitoba</option>
              <option value="SK">Saskatchewan</option>
              <option value="QC">Quebec</option>
              <option value="NB">New Brunswick</option>
              <option value="NS">Nova Scotia</option>
              <option value="PE">Prince Edward Island</option>
              <option value="NL">Newfoundland and Labrador</option>
              <option value="YT">Yukon</option>
              <option value="NT">Northwest Territories</option>
              <option value="NU">Nunavut</option>
            </select>
          </div>
        </div>
        
        <div class="form-row">
          <div>
            <label for="fp-postal-code" class="optional">Postal Code</label>
            <input type="text" id="fp-postal-code" name="fp-postal-code" placeholder="A1A 1A1">
          </div>
          <div>
            <label for="fp-country" class="optional">Country</label>
            <input type="text" id="fp-country" name="fp-country" value="Canada">
          </div>
        </div>
      </div>
    </fieldset>

    <!-- Emergency Contact Information -->
    <fieldset class="emergency-contact-info">
      <legend>Emergency Contact Information</legend>
      
      <div class="form-row">
        <div>
          <label for="ec-full-name" class="required">Full Name</label>
          <input type="text" id="ec-full-name" name="ec-full-name" required>
        </div>
        <div>
          <label for="ec-relationship" class="required">Relationship</label>
          <select id="ec-relationship" name="ec-relationship" required>
            <option value="">Select Relationship</option>
            <option value="Spouse">Spouse</option>
            <option value="Parent">Parent</option>
            <option value="Child">Child</option>
            <option value="Sibling">Sibling</option>
            <option value="Friend">Friend</option>
            <option value="Partner">Partner</option>
            <option value="Guardian">Legal Guardian</option>
            <option value="Other">Other</option>
          </select>
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="ec-phone" class="required">Primary Phone</label>
          <input type="tel" id="ec-phone" name="ec-phone" required>
        </div>
        <div>
          <label for="ec-alt-phone" class="optional">Alternative Phone</label>
          <input type="tel" id="ec-alt-phone" name="ec-alt-phone">
        </div>
      </div>
    </fieldset>

    <!-- Legal Representative Information -->
    <fieldset class="legal-representative-info">
      <legend>Legal Representative Information <span class="optional">(Optional)</span></legend>
      
      <div class="form-row">
        <div>
          <label for="lr-company-name" class="optional">Law Firm / Company Name</label>
          <input type="text" id="lr-company-name" name="lr-company-name">
        </div>
        <div>
          <label for="lr-full-name" class="optional">Representative Name</label>
          <input type="text" id="lr-full-name" name="lr-full-name">
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="lr-phone" class="optional">Phone</label>
          <input type="tel" id="lr-phone" name="lr-phone">
        </div>
        <div>
          <label for="lr-email" class="optional">Email</label>
          <input type="email" id="lr-email" name="lr-email">
        </div>
      </div>
    </fieldset>

    <!-- Insurance Company Information -->
    <fieldset class="insurance-company-info">
      <legend>Insurance Company Information <span class="optional">(Optional)</span></legend>
      
      <div class="form-row">
        <div>
          <label for="ic-company-name" class="optional">Insurance Company Name</label>
          <input type="text" id="ic-company-name" name="ic-company-name">
        </div>
        <div>
          <label for="ic-adjuster-name" class="optional">Adjuster Name</label>
          <input type="text" id="ic-adjuster-name" name="ic-adjuster-name">
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="ic-phone" class="optional">Phone</label>
          <input type="tel" id="ic-phone" name="ic-phone">
        </div>
        <div>
          <label for="ic-email" class="optional">Email</label>
          <input type="email" id="ic-email" name="ic-email">
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="ic-claim-number" class="optional">Claim Number</label>
          <input type="text" id="ic-claim-number" name="ic-claim-number">
        </div>
        <div>
          <label for="ic-policy-number" class="optional">Policy Number</label>
          <input type="text" id="ic-policy-number" name="ic-policy-number">
        </div>
      </div>
      
      <div class="form-row">
        <div>
          <label for="ic-date-accident" class="optional">Date of Accident</label>
          <input type="date" id="ic-date-accident" name="ic-date-accident">
        </div>
        <div></div> <!-- Empty div for spacing -->
      </div>
    </fieldset>

    <!-- Case Notes -->
    <fieldset class="case-notes-info">
      <legend>Case Notes</legend>
      
      <label for="case-notes" class="optional">Additional Notes</label>
      <textarea id="case-notes" name="case-notes" 
                placeholder="Enter any additional notes or relevant information about this case..."></textarea>
      
      <div style="background: #fff8e1; padding: 1rem; border-radius: 0.35rem; border-left: 4px solid var(--warning-color); margin-top: 1rem;">
        <p style="margin: 0; color: var(--warning-color);"><strong><i class="bi bi-exclamation-triangle"></i> Note:</strong></p>
        <p style="margin: 0.5rem 0 0 0;">Maximum 1500 characters for case notes. This information will be attached to the case profile.</p>
      </div>
    </fieldset>

    <!-- Buttons for saving the form -->
    <div class="button-container">
      <button type="button" id="save-btn" class="form-action-btn">
        <i class="bi bi-download"></i> Save Case Profile Data
      </button>
    </div>

    <footer class="form-footer">
      <div class="footer-contact">
        <p style="margin: 0;">© <span id="copyright-year">2025</span> Silver Linings Therapy And Assessment Services</p>
      </div>
      <div class="footer-info">
        <p style="margin: 0;">All information provided is confidential and will be used to create a complete case profile.</p>
      </div>
    </footer>
  </form>

  <script>
    // ========================= 
    //    Case Profile Form JavaScript
    // ========================= 

    document.addEventListener('DOMContentLoaded', function() {
      // Set current timestamp
      setFormTimestamp();
      
      // Setup form save functionality
      setupFormSave();
      
      // Setup form validation and button state
      setupFormValidation();
      
      // Setup input formatting
      setupInputFormatting();
      
      // Update copyright year
      document.getElementById('copyright-year').textContent = new Date().getFullYear();
    });

    // Set form creation timestamp
    function setFormTimestamp() {
      const now = new Date();
      const timestamp = now.toISOString().replace('T', ' ').substring(0, 19);
      document.getElementById('form-created-at').value = timestamp;
    }

    // Setup input formatting for phones, postal codes, etc.
    function setupInputFormatting() {
      // Format postal codes
      const postalCodeInputs = document.querySelectorAll('input[id$="-postal-code"]');
      postalCodeInputs.forEach(input => {
        input.addEventListener('input', function() {
          formatPostalCode(this);
        });
      });

      // Format phone numbers
      const phoneInputs = document.querySelectorAll('input[type="tel"]');
      phoneInputs.forEach(input => {
        input.addEventListener('input', function() {
          formatPhoneNumber(this);
        });
      });

      // Capitalize names
      const nameInputs = document.querySelectorAll('#fp-full-name, #ec-full-name, #lr-full-name, #ic-adjuster-name, #fp-city');
      nameInputs.forEach(input => {
        input.addEventListener('blur', function() {
          capitalizeName(this);
        });
      });
    }

    // Format postal code (Canadian format: A1A 1A1)
    function formatPostalCode(input) {
      let value = input.value.replace(/\s/g, '').toUpperCase();
      if (value.length === 6) {
        value = value.substring(0, 3) + ' ' + value.substring(3);
      }
      input.value = value;
    }

    // Format phone number (basic formatting)
    function formatPhoneNumber(input) {
      let value = input.value.replace(/\D/g, '');
      if (value.length === 10) {
        value = `(${value.substring(0, 3)}) ${value.substring(3, 6)}-${value.substring(6)}`;
      }
      input.value = value;
    }

    // Capitalize names
    function capitalizeName(input) {
      const words = input.value.toLowerCase().split(' ');
      const capitalizedWords = words.map(word => 
        word.charAt(0).toUpperCase() + word.slice(1)
      );
      input.value = capitalizedWords.join(' ');
    }

    // Setup form validation and button state management
    function setupFormValidation() {
      const saveBtn = document.getElementById('save-btn');
      
      // Initially disable the save button
      saveBtn.disabled = true;
      
      // Get all required inputs
      const requiredInputs = document.querySelectorAll('input[required], select[required]');
      
      // Add event listeners to all required inputs
      requiredInputs.forEach(input => {
        input.addEventListener('input', function() {
          updateSaveButtonState();
        });
        input.addEventListener('change', function() {
          updateSaveButtonState();
        });
      });
      
      // Initial check
      updateSaveButtonState();
    }

    // Update save button state based on form completion
    function updateSaveButtonState() {
      const saveBtn = document.getElementById('save-btn');
      
      // Check if all required fields are filled
      const requiredInputs = document.querySelectorAll('input[required], select[required]');
      let allRequiredFilled = true;
      
      requiredInputs.forEach(input => {
        if (!input.value.trim()) {
          allRequiredFilled = false;
        }
      });
      
      // Enable/disable save button
      saveBtn.disabled = !allRequiredFilled;
    }

    // Setup form save functionality
    function setupFormSave() {
      const saveBtn = document.getElementById('save-btn');
      
      saveBtn.addEventListener('click', function() {
        if (validateForm()) {
          saveFormData();
        } else {
          alert('Please fill in all required fields before saving.');
        }
      });
    }

    // Validate form
    function validateForm() {
      const requiredInputs = document.querySelectorAll('input[required], select[required]');
      let allValid = true;
      
      requiredInputs.forEach(input => {
        if (!input.value.trim()) {
          allValid = false;
        }
      });
      
      // Validate case notes length
      const caseNotes = document.getElementById('case-notes').value;
      if (caseNotes.length > 1500) {
        alert('Case notes cannot exceed 1500 characters.');
        return false;
      }
      
      return allValid;
    }

    // Save form data to CSV
    function saveFormData() {
      const formData = collectFormData();
      const csvContent = generateCSV(formData);
      downloadCSV(csvContent, `CaseProfile_${new Date().toISOString().split('T')[0]}.csv`);
    }

    // Collect all form data
    function collectFormData() {
      return {
        // Form Info
        formCreatedAt: document.getElementById('form-created-at').value,
        
        // Family Physician
        fpFullName: document.getElementById('fp-full-name').value,
        fpPhone: document.getElementById('fp-phone').value,
        fpEmail: document.getElementById('fp-email').value,
        fpAddress: document.getElementById('fp-address').value,
        fpCity: document.getElementById('fp-city').value,
        fpProvince: document.getElementById('fp-province').value,
        fpPostalCode: document.getElementById('fp-postal-code').value,
        fpCountry: document.getElementById('fp-country').value,
        
        // Emergency Contact
        ecFullName: document.getElementById('ec-full-name').value,
        ecRelationship: document.getElementById('ec-relationship').value,
        ecPhone: document.getElementById('ec-phone').value,
        ecAltPhone: document.getElementById('ec-alt-phone').value,
        
        // Legal Representative
        lrCompanyName: document.getElementById('lr-company-name').value,
        lrFullName: document.getElementById('lr-full-name').value,
        lrPhone: document.getElementById('lr-phone').value,
        lrEmail: document.getElementById('lr-email').value,
        
        // Insurance Company
        icCompanyName: document.getElementById('ic-company-name').value,
        icAdjusterName: document.getElementById('ic-adjuster-name').value,
        icPhone: document.getElementById('ic-phone').value,
        icEmail: document.getElementById('ic-email').value,
        icClaimNumber: document.getElementById('ic-claim-number').value,
        icPolicyNumber: document.getElementById('ic-policy-number').value,
        icDateAccident: document.getElementById('ic-date-accident').value,
        
        // Case Notes
        caseNotes: document.getElementById('case-notes').value
      };
    }

    // Generate CSV content
    function generateCSV(data) {
      const headers = [
        'Form_Created_At',
        'FP_Full_Name', 'FP_Phone', 'FP_Email', 'FP_Address', 'FP_City', 'FP_Province', 'FP_Postal_Code', 'FP_Country',
        'EC_Full_Name', 'EC_Relationship', 'EC_Phone', 'EC_Alt_Phone',
        'LR_Company_Name', 'LR_Full_Name', 'LR_Phone', 'LR_Email',
        'IC_Company_Name', 'IC_Adjuster_Name', 'IC_Phone', 'IC_Email', 'IC_Claim_Number', 'IC_Policy_Number', 'IC_Date_Accident',
        'Case_Notes'
      ];

      const values = [
        data.formCreatedAt,
        `"${data.fpFullName.replace(/"/g, '""')}"`,
        data.fpPhone,
        data.fpEmail,
        `"${data.fpAddress.replace(/"/g, '""')}"`,
        `"${data.fpCity.replace(/"/g, '""')}"`,
        data.fpProvince,
        data.fpPostalCode,
        `"${data.fpCountry.replace(/"/g, '""')}"`,
        `"${data.ecFullName.replace(/"/g, '""')}"`,
        data.ecRelationship,
        data.ecPhone,
        data.ecAltPhone,
        `"${data.lrCompanyName.replace(/"/g, '""')}"`,
        `"${data.lrFullName.replace(/"/g, '""')}"`,
        data.lrPhone,
        data.lrEmail,
        `"${data.icCompanyName.replace(/"/g, '""')}"`,
        `"${data.icAdjusterName.replace(/"/g, '""')}"`,
        data.icPhone,
        data.icEmail,
        data.icClaimNumber,
        data.icPolicyNumber,
        data.icDateAccident,
        `"${data.caseNotes.replace(/"/g, '""')}"`
      ];

      return headers.join(',') + '\n' + values.join(',');
    }

    // Download CSV file
    function downloadCSV(csvContent, filename) {
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      
      if (link.download !== undefined) {
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', filename);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        alert(`Case Profile data saved as ${filename}`);
      } else {
        alert('File download not supported in this browser.');
      }
    }

    // Update copyright year
    document.getElementById('copyright-year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
